<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT API Test</title>
</head>
<body>
    <div class="response" id="response"></div>
        <form id="submitForm">
            <input type="text" name="textfield" id="textfield">
            <input type="submit" value="submit" id="submit">
        </form>
    <div class="instructions">
        <h1>Instuctions:</h1>
        <p>This is an interactive game, simply tell the AI what you would like to do and it will make play along.</p></div>
    
</body>
<script>
    let response = ''
    //const googleApiKey = 
    //const googleUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`
    const gptApi =
    const url = 'https://api.openai.com/v1/chat/completions'
    let message = {}
    let responseMessage = {}

    //sendMessage('Generate an apocalyptic survival scenario. The objective is to gataher what is needed to survive, the player must eat 3 meals a day and stay warm. The standard seasons apply, and you can randomly generate weather on any day. The game starts with the player waking up, and player must decide what to do. Provide a random name and backstory for the player. There are no limits and nothing is gamebreaking.')

    const submitForm = document.getElementById('submitForm')

    submitForm.addEventListener("submit", (event) => {
        event.preventDefault()
        text = event.target[0].value //Extract the text value inside the event

        sendMessage(text)


    })

    function sendMessage(text) {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', url, false)
        xhr.setRequestHeader(`Authorization`, `Bearer ${gptApi}`)
        xhr.setRequestHeader('Content-Type', 'application/json')


        console.log(responseMessage)
        
        if (Object.values(responseMessage).length === 0) {
            message = {
                "model": "gpt-3.5-turbo",
                "messages": [
                    {
                        "role": "user",
                        "content": text 
                    }
                ]
            }
        } else {
            newMessage = {
                "model": "gpt-3.5-turbo",
                "messages": [
                    {
                        "role": "user",
                        "content": text 
                    }
                ]
            }
            
            message = {
                "model": "gpt-3.5-turbo",
                "messages": [
                    ...responseMessage.messages,
                    ...newMessage.messages
                ]
            }

            responseMessage
            console.log(message)
        } 

        xhr.send(JSON.stringify(message))

        if (xhr.status === 200) {
            response = JSON.parse(xhr.responseText)
            console.log(response)

            const textWithLineBreaks = response.choices[0].message.content.replace(/\n/g, '<br>');
            document.getElementById('response').innerHTML = textWithLineBreaks;


            //console.log(response)

            responseMessage = {
                "messages": [
                    ...message.messages,
                    response.choices[0].message
                ]
            }
            console.log(responseMessage)
        } else {
            console.log(xhr)
        }



    }

 

</script>
</html>